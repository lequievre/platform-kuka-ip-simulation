<?xml version="1.0"?>

<robot xmlns:xacro="http://ros.org/wiki/xacro">

	<!-- Import all Gazebo-customization elements, including Gazebo colors -->
	<xacro:include filename="$(find barrett_hand_description)/urdf/ip_bh280.gazebo.xacro" />
	
	<!-- Import all transmissions -->
	<xacro:include filename="$(find barrett_hand_description)/urdf/ip_bh280.transmission.xacro" />
	
	<!-- Constants for robot dimensions -->
	<xacro:property name="PI" value="3.1415926535897931"/>
	<xacro:property name="PI_2" value="1.570796327"/>
	<xacro:property name="joint_damping" value="100.0" />
	<xacro:property name="joint_friction" value="1.0" />
	<xacro:property name="joint_effort_limit" value="30.0" />
	<xacro:property name="joint_velocity_limit" value="2.0" />

	<xacro:macro name="bhand_macro" params="parent name namespace *origin">
		
        <!-- base joint (FIXED) -->
		<joint name="${name}_base_joint" type="fixed">
			<xacro:insert_block name="origin"/>
			<parent link="${parent}"/>
			<child link="${name}_base_link"/>
		</joint>  
		
		<!-- HAND BASE_LINK (RED) (PALM) -->
		<link name="${name}_base_link">
			<inertial>
			  <mass value="1.0" />
			  <origin xyz="0 0 0" />
			  <inertia  ixx="1.0" ixy="0.0"  ixz="0.0"  iyy="1.0"  iyz="0.0"  izz="1.0" />
			</inertial>
			<visual>
			   <origin xyz="0 0 0" rpy="0 0 0" />
			   <geometry>
				  <mesh filename="package://barrett_hand_description/meshes/palm_280.dae"/>
			   </geometry>
			   <material name="Grey">
				  <color rgba="0.75 0.75 0.75 1.0"/>
			   </material>
			</visual>
			<collision>
			   <origin xyz="0 0 0" rpy="0 0 0 " />
			   <geometry name="${name}_base_link_geom">
				  <mesh filename="package://barrett_hand_description/meshes/palm_280.dae"/>
			   </geometry>
			   <contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
			</collision>     
		</link>

		<!-- finger 1 -->
		<!-- finger 11 link (KNUCKLE) -->
		<link name="${name}_finger_11_link">
			<inertial>
			  <mass value="0.1"/>
			  <origin xyz="-0.046 0 0" rpy="0 0 0"/>
			  <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
			</inertial>
			<visual>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry>
				 <mesh filename="package://barrett_hand_description/meshes/knuckle.dae" />
			  </geometry>
			  <material name="Green" />
			</visual>
			<collision>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry name="${name}_finger_11_link_geom">
				<mesh filename="package://barrett_hand_description/meshes/knuckle.dae" />
			  </geometry>
			</collision>
		</link>

		<!-- joint 11 between BH_base_link (PALM) and BH_finger_11_link (KNUCKLE) -->
		<joint name="${name}_j11_joint" type="revolute">
			<parent link="${name}_base_link"/>
			<child link="${name}_finger_11_link"/>
			<origin xyz="0.025 0 0.0415" rpy="0 0 -1.5708" />
			<axis xyz="0 0 -1"/>
			<limit effort="${joint_effort_limit}" lower="0" upper="3.1416" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>
		
		<!-- finger 12 link (FINGER) (PROXIMAL) -->
		<link name="${name}_finger_12_link">
			 <inertial>
				<mass value="0.1"/>
				<origin xyz="0 0 0" rpy="0 0 0"/>
				<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
			 </inertial>
			 <visual>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry>
				  <mesh filename="package://barrett_hand_description/meshes/finger.dae" />
				</geometry>
				<material name="Blue" />
			 </visual>		
			 <collision>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry name="${name}_finger_12_link_geom">
				  <mesh filename="package://barrett_hand_description/meshes/finger.dae" />
				</geometry>
				<contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
			 </collision>
		</link>

		<!-- joint 12 between BH_finger_11_link (KNUCKLE) and BH_finger_12_link (FINGER) -->
		<joint name="${name}_j12_joint" type="revolute">
			<parent link="${name}_finger_11_link"/>
			<child link="${name}_finger_12_link"/>
			<origin	xyz="-0.05 0 0.0339"
				rpy="1.5708 0 0" />
			<axis xyz="0 0 -1"/>
			<limit effort="${joint_effort_limit}" lower="0.0" upper="2.44" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>
		
		<!-- finger 13 link (FINGER TIP) (DISTAL) -->
		<link name="${name}_finger_13_link">
		 <inertial>
			<mass value="0.1"/>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
		 </inertial>
		 <visual>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
			  <mesh filename="package://barrett_hand_description/meshes/finger_tip.dae" />
			</geometry>
			<material name="Blue" />
		 </visual>		
		 <collision>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry name="${name}_finger_13_link_geom">
			  <mesh filename="package://barrett_hand_description/meshes/finger_tip.dae" />
			</geometry>
			<contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
		 </collision>
		</link>

		<!-- joint 13 between BH_finger_12_link (FINGER) and BH_finger_13_link (FINGER TIP) -->
		<joint name="${name}_j13_joint" type="revolute">
			<parent link="${name}_finger_12_link"/>
			<child link="${name}_finger_13_link"/>
			<origin xyz="-0.069936 0.003 0" rpy="0 0 0" />
			<axis xyz="0 0 -1"/>
			<!--<mimic joint="${name}_j12_joint" multiplier="${0.84/2.44}" />-->
			<limit effort="${joint_effort_limit}" lower="0.0" upper="0.84" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>

		<!-- finger 2 -->
		<!-- finger 21 link (KNUCKLE) -->
		<link name="${name}_finger_21_link">
			<inertial>
			  <mass value="0.1"/>
			  <origin xyz="-0.046 0 0" rpy="0 0 0"/>
			  <inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
			</inertial>
			<visual>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry>
				 <mesh filename="package://barrett_hand_description/meshes/knuckle.dae" />
			  </geometry>
			  <material name="Green" />
			</visual>
			<collision>
			  <origin xyz="0 0 0" rpy="0 0 0" />
			  <geometry name="${name}_finger_21_link_geom">
				<mesh filename="package://barrett_hand_description/meshes/knuckle.dae" />
			  </geometry>
			</collision>
		</link>

		<!-- joint 21 between BH_base_link (PALM) and BH_finger_21_link (KNUCKLE) -->
		<joint name="${name}_j21_joint" type="revolute">
			<parent link="${name}_base_link"/>
			<child link="${name}_finger_21_link"/>
			<origin xyz="-0.025 0 0.0415" rpy="0 0 -1.5708" />
			<axis xyz="0 0 1"/>
			<!--<mimic joint="${name}_j11_joint" multiplier="1" />-->
			<limit effort="${joint_effort_limit}" lower="0" upper="3.1416" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>
		
		<!-- finger 22 link (FINGER) (PROXIMAL) -->
		<link name="${name}_finger_22_link">
			 <inertial>
				<mass value="0.1"/>
				<origin xyz="0 0 0" rpy="0 0 0"/>
				<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
			 </inertial>
			 <visual>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry>
				  <mesh filename="package://barrett_hand_description/meshes/finger.dae" />
				</geometry>
				<material name="Blue" />
			 </visual>		
			 <collision>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry name="${name}_finger_22_link_geom">
				  <mesh filename="package://barrett_hand_description/meshes/finger.dae" />
				</geometry>
				<contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
			 </collision>
		</link>

		<!-- joint 22 between BH_finger_21_link (KNUCKLE) and BH_finger_22_link (FINGER) -->
		<joint name="${name}_j22_joint" type="revolute">
			<parent link="${name}_finger_21_link"/>
			<child link="${name}_finger_22_link"/>
			<origin	xyz="-0.05 0 0.0339"
				rpy="1.5708 -8.8281E-17 0" />
			<axis xyz="0 0 -1"/>
			<limit effort="${joint_effort_limit}" lower="0.0" upper="2.44" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>
		
		<!-- finger 23 link (FINGER TIP) (DISTAL) -->
		<link name="${name}_finger_23_link">
		 <inertial>
			<mass value="0.1"/>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
		 </inertial>
		 <visual>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
			  <mesh filename="package://barrett_hand_description/meshes/finger_tip.dae" />
			</geometry>
			<material name="Blue" />
		 </visual>		
		 <collision>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry name="${name}_finger_23_link_geom">
			  <mesh filename="package://barrett_hand_description/meshes/finger_tip.dae" />
			</geometry>
			<contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
		 </collision>
		</link>

		<!-- joint 23 between BH_finger_22_link (FINGER) and BH_finger_23_link (FINGER TIP) -->
		<joint name="${name}_j23_joint" type="revolute">
			<parent link="${name}_finger_22_link"/>
			<child link="${name}_finger_23_link"/>
			<origin xyz="-0.069936 0.003 0" rpy="0 0 0" />
			<axis xyz="0 0 -1"/>
			<!--<mimic joint="${name}_j22_joint" multiplier="${0.84/2.44}" />-->
			<limit effort="${joint_effort_limit}" lower="0.0" upper="0.84" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>
		
		<!-- finger 3 -->		
		<!-- finger 32 link (PROXIMAL) -->
		<link name="${name}_finger_32_link">
			 <inertial>
				<mass value="0.1"/>
				<origin xyz="0 0 0" rpy="0 0 0"/>
				<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
			 </inertial>
			 <visual>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry>
				  <mesh filename="package://barrett_hand_description/meshes/finger.dae" />
				</geometry>
				<material name="Blue" />
			 </visual>		
			 <collision>
				<origin xyz="0 0 0" rpy="0 0 0" />
				<geometry name="${name}_finger_32_link_geom">
				  <mesh filename="package://barrett_hand_description/meshes/finger.dae" />
				</geometry>
				<contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
			 </collision>
		</link>

		<!-- joint 32 between BH_base_link (PALM) and BH_finger_32_link -->
		<joint name="${name}_j32_joint" type="revolute">
			<parent link="${name}_base_link"/>
			<child link="${name}_finger_32_link"/>
			<origin xyz="0 -0.05 0.0754" rpy="1.5708 0 1.5708" />
			<axis xyz="0 0 -1"/>
			<limit effort="${joint_effort_limit}" lower="0.0" upper="2.44" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>

		<!-- finger 33 link (DISTAL) -->
		<link name="${name}_finger_33_link">
		 <inertial>
			<mass value="0.1"/>
			<origin xyz="0 0 0" rpy="0 0 0"/>
			<inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01" />
		 </inertial>
		 <visual>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry>
			  <mesh filename="package://barrett_hand_description/meshes/finger_tip.dae" />
			</geometry>
			<material name="Blue" />
		 </visual>		
		 <collision>
			<origin xyz="0 0 0" rpy="0 0 0" />
			<geometry name="${name}_finger_33_link_geom">
			  <mesh filename="package://barrett_hand_description/meshes/finger_tip.dae" />
			</geometry>
			<contact_coefficients kd="1.0" kp="1000.0" mu="0"/>
		 </collision>
		</link>

		<!-- joint 33 between BH_finger_32_link and BH_finger_33_link -->
		<joint name="${name}_j33_joint" type="revolute">
			<parent link="${name}_finger_32_link"/>
			<child link="${name}_finger_33_link"/>
			<origin xyz="-0.069936 0.003 0" rpy="0 0 0" />
			<axis xyz="0 0 -1"/>
			<!--<mimic joint="${name}_j32_joint" multiplier="${0.84/2.44}" />-->
			<limit effort="${joint_effort_limit}" lower="0.0" upper="0.84" velocity="${joint_velocity_limit}"/>
			<dynamics damping="${joint_damping}" friction="${joint_friction}"/>
		</joint>
		
		<xacro:bh280_transmission name="${name}"/>
		<xacro:bh_gazebo name="${name}" namespace="${namespace}"/>
		
	</xacro:macro>
	
</robot>

